{"version":3,"file":"markdownItRegexp.mjs","sources":["../lib/utils.js","../lib/index.js"],"sourcesContent":["/*!\n * markdown-it-regexp\n * Copyright (c) 2014 Alex Kocharin\n * MIT Licensed\n */\n\n/**\n * Escape special characters in the given string of html.\n *\n * Borrowed from escape-html component, MIT-licensed\n */\nexport default function escape(html) {\n  return String(html)\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n}\n\n","/*!\n * markdown-it-regexp\n * Copyright (c) 2014 Alex Kocharin\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n */\n\nimport escape from './utils';\n\n/**\n * Counter for multi usage.\n */\nlet counter = 0;\nlet registered_ids = [];\n\n/**\n * Constructor function\n */\nfunction createPlugin(regexp, replacer, plugin_id) {\n  // clone regexp with all the flags\n  let flags = (regexp.global     ? 'g' : '')\n            + (regexp.multiline  ? 'm' : '')\n            + (regexp.ignoreCase ? 'i' : '');\n\n  regexp = RegExp('^' + regexp.source, flags);\n\n  // this plugin can be inserted multiple times,\n  // so we're generating unique name for it\n  let id = plugin_id;\n  if (id && registered_ids['p-' + id]) {\n    throw new Error(`Plugin ID '${id}' has already been registered by another plugin or this plugin is registered multiple times.`);\n  }\n  if (!id) {\n    id = 'regexp-' + counter;\n    while (registered_ids['p-' + id]) {\n      counter++;\n      id = 'regexp-' + counter;\n    }\n  }\n  registered_ids['p-' + id] = true;\n\n  // closure var\n  let plugin_options;\n\n  // return value should be a callable function\n  // with strictly defined options passed by markdown-it\n  let handler = function cbHandler(md, options) {\n    plugin_options = options;\n    init(md);\n  };\n\n  // function that registers plugin with markdown-it\n  function init(md) {\n    md.inline.ruler.push(id, parse);\n\n    md.renderer.rules[id] = render;\n  }\n\n  function parse(state, silent) {\n    // slowwww... maybe use an advanced regexp engine for this\n    let match = regexp.exec(state.src.slice(state.pos));\n    if (!match) return false;\n\n    // valid match found, now we need to advance cursor\n    state.pos += match[0].length;\n\n    // don't insert any tokens in silent mode\n    if (silent) return true;\n\n    let token = state.push(id, '', 0);\n    token.meta = { match: match };\n\n    return true;\n  }\n\n  function render(tokens, id, options, env) {\n    return replacer(tokens[id].meta.match, { escape }, plugin_options, env);\n  }\n\n  return handler;\n}\n\n\n/**\n * Expose `Plugin`\n */\n\nexport default createPlugin;\n\n"],"names":["escape","html","String","replace","counter","registered_ids","createPlugin","regexp","replacer","plugin_id","flags","global","multiline","ignoreCase","RegExp","source","id","Error","plugin_options","handler","cbHandler","md","options","init","inline","ruler","push","parse","renderer","rules","render","state","silent","match","exec","src","slice","pos","length","token","meta","tokens","env"],"mappings":"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"}